!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).detox_dht=t()}}(function(){return function(){return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){return i(e[s][1][t]||t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}}()({1:[function(t,e,n){(function(t){function n(t,e,n){for(var r=0,i=1,o=e;o<n;o++){var s=t[o];if(s<58&&s>=48)r=10*r+(s-48);else if(o!==e||43!==s){if(o!==e||45!==s){if(46===s)break;throw new Error("not a number: buffer["+o+"] = "+s)}i=-1}}return r*i}function r(e,n,i,o){return null==e||0===e.length?null:("number"!=typeof n&&null==o&&(o=n,n=void 0),"number"!=typeof i&&null==o&&(o=i,i=void 0),r.position=0,r.encoding=o||null,r.data=t.isBuffer(e)?e.slice(n,i):new t(e),r.bytes=r.data.length,r.next())}r.bytes=0,r.position=0,r.data=null,r.encoding=null,r.next=function(){switch(r.data[r.position]){case 100:return r.dictionary();case 108:return r.list();case 105:return r.integer();default:return r.buffer()}},r.find=function(t){for(var e=r.position,n=r.data.length,i=r.data;e<n;){if(i[e]===t)return e;e++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(t)+'" [0x'+t.toString(16)+"]")},r.dictionary=function(){r.position++;for(var t={};101!==r.data[r.position];)t[r.buffer()]=r.next();return r.position++,t},r.list=function(){r.position++;for(var t=[];101!==r.data[r.position];)t.push(r.next());return r.position++,t},r.integer=function(){var t=r.find(101),e=n(r.data,r.position+1,t);return r.position+=t+1-r.position,e},r.buffer=function(){var t=r.find(58),e=n(r.data,r.position,t),i=++t+e;return r.position=i,r.encoding?r.data.toString(r.encoding,t,i):r.data.slice(t,i)},e.exports=r}).call(this,t("buffer").Buffer)},{buffer:10}],2:[function(t,e,n){var r=t("safe-buffer").Buffer;function i(t,e,n){var o=[],s=null;return i._encode(o,t),s=r.concat(o),i.bytes=s.length,r.isBuffer(e)?(s.copy(e,n),e):s}i.bytes=-1,i._floatConversionDetected=!1,i.getType=function(t){return r.isBuffer(t)?"buffer":Array.isArray(t)?"array":ArrayBuffer.isView(t)?"arraybufferview":t instanceof Number?"number":t instanceof Boolean?"boolean":t instanceof ArrayBuffer?"arraybuffer":typeof t},i._encode=function(t,e){if(null!=e)switch(i.getType(e)){case"buffer":i.buffer(t,e);break;case"object":i.dict(t,e);break;case"array":i.list(t,e);break;case"string":i.string(t,e);break;case"number":case"boolean":i.number(t,e);break;case"arraybufferview":i.buffer(t,r.from(e.buffer,e.byteOffset,e.byteLength));break;case"arraybuffer":i.buffer(t,r.from(e))}};var o=r.from("e"),s=r.from("d"),u=r.from("l");i.buffer=function(t,e){t.push(new r(e.length+":"),e)},i.string=function(t,e){t.push(r.from(r.byteLength(e)+":"+e))},i.number=function(t,e){var n=2147483648*(e/2147483648<<0)+(e%2147483648<<0);t.push(r.from("i"+n+"e")),n===e||i._floatConversionDetected||(i._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+e+'":','Bencoding only defines support for integers, value was converted to "'+n+'"'),console.trace())},i.dict=function(t,e){t.push(s);for(var n,r=0,u=Object.keys(e).sort(),c=u.length;r<c;r++)null!=e[n=u[r]]&&(i.string(t,n),i._encode(t,e[n]));t.push(o)},i.list=function(t,e){var n=0,r=e.length;for(t.push(u);n<r;n++)null!=e[n]&&i._encode(t,e[n]);t.push(o)},e.exports=i},{"safe-buffer":26}],3:[function(t,e,n){var r=e.exports;r.encode=t("./encode"),r.decode=t("./decode"),r.byteLength=r.encodingLength=function(t){return r.encode(t).length}},{"./decode":1,"./encode":2}],4:[function(t,e,n){(function(n){e.exports=v;var r=t("bencode"),i=t("safe-buffer").Buffer,o=function(){},s=t("buffer-equals"),u=t("events").EventEmitter,c=t("inherits"),a=t("k-bucket"),f=t("k-rpc"),h=t("lru"),l=t("randombytes"),p=t("simple-sha1"),d=t("record-cache"),g=t("last-one-wins"),_=3e5,y=9e5;function v(t){if(!(this instanceof v))return new v(t);t||(t={});var e=this;this._tables=h({maxAge:_,max:t.maxTables||1e3}),this._values=h(t.maxValues||1e3),this._peers=d({maxAge:t.maxAge||0,maxSize:t.maxPeers||1e4}),this._secrets=null,this._hash=t.hash||b,this._hashLength=this._hash(i.from("")).length,this._rpc=t.krpc||f(Object.assign({idLength:this._hashLength},t)),this._rpc.on("query",function(t,n){e._onquery(t,n)}),this._rpc.on("node",function(t){e.emit("node",t)}),this._rpc.on("warning",function(t){e.emit("warning",t)}),this._rpc.on("error",function(t){e.emit("error",t)}),this._rpc.on("listening",function(){e.listening=!0,e._debug("listening %d",e.address().port),e.updateBucketTimestamp(),e._setBucketCheckInterval(),e.emit("listening")}),this._rotateSecrets(),this._verify=t.verify||null,this._host=t.host||null,this._interval=setInterval(function(){e._rotateSecrets()},_),this._runningBucketCheck=!1,this._bucketCheckTimeout=null,this._bucketOutdatedTimeSpan=t.timeBucketOutdated||y,this.listening=!1,this.destroyed=!1,this.nodeId=this._rpc.id,this.nodes=this._rpc.nodes;var r=g(function(t,n){var r=t.older,i=t.swap;e._debug("received ping",r),e._checkNodes(r,!1,function(t,r){if(r)return e._debug("swaping dead node with newer",r),i(r),n();e._debug("no node added, all other nodes ok"),n()})});this._rpc.on("ping",function(t,e){r({older:t,swap:e})}),n.nextTick(function(){e.destroyed||e._bootstrap(!1!==t.bootstrap)}),u.call(this),this._debug("new DHT %s",this.nodeId)}function m(){}function b(t){return i.from(p.sync(t),"hex")}function w(t,e,n){var r={id:t,token:e,v:n.v};return n.sig&&(r.sig=n.sig,r.k=n.k,n.salt&&(r.salt=n.salt),"number"==typeof n.seq&&(r.seq=n.seq)),r}function k(t,e){return t[e++]+"."+t[e++]+"."+t[e++]+"."+t[e++]}function x(t){var e={seq:t.seq||0,v:t.v};return t.salt&&(e.salt=t.salt),r.encode(e).slice(1,-1)}function E(t){return{host:t.host,port:t.port}}function A(t){if(i.isBuffer(t))return t;if(ArrayBuffer.isView(t))return i.from(t.buffer,t.byteOffset,t.byteLength);if("string"==typeof t)return i.from(t,"hex");throw new Error("Pass a buffer or a string")}c(v,u),v.prototype._setBucketCheckInterval=function(){var t=this,e=6e4;function n(){if(Date.now()-t._rpc.nodes.metadata.lastChange<t._bucketOutdatedTimeSpan)return r();t._pingAll(function(){t.destroyed||(t.nodes.toArray().length<1&&t._bootstrap(!0),r())})}function r(){if(t._runningBucketCheck&&!t.destroyed){var r=Math.floor(Math.random()*e+e/2);t._bucketCheckTimeout=setTimeout(n,r)}}this._runningBucketCheck=!0,r()},v.prototype._pingAll=function(t){this._checkAndRemoveNodes(this.nodes.toArray(),t)},v.prototype.removeBucketCheckInterval=function(){this._runningBucketCheck=!1,clearTimeout(this._bucketCheckTimeout)},v.prototype.updateBucketTimestamp=function(){this._rpc.nodes.metadata.lastChange=Date.now()},v.prototype._checkAndRemoveNodes=function(t,e){var n=this;this._checkNodes(t,!0,function(t,r){r&&n.removeNode(r.id),e(null,r)})},v.prototype._checkNodes=function(t,e,n){var r=this;!function t(i){var o=null;for(;i.length&&(o=i.pop()).id&&!e&&!(Date.now()-(o.seen||0)>1e4);)o=null;if(!o)return n(null);r._sendPing(o,function(e){if(!e)return r.updateBucketTimestamp(),t(i);n(null,o)})}(t)},v.prototype.addNode=function(t){var e=this;if(t.id){t.id=A(t.id);var n=!!this._rpc.nodes.get(t.id);return this._rpc.nodes.add(t),void(n||(this.emit("node",t),this.updateBucketTimestamp()))}this._sendPing(t,function(t,n){n&&e.addNode(n)})},v.prototype.removeNode=function(t){this._rpc.nodes.remove(A(t))},v.prototype._sendPing=function(t,e){var n=this,r=t.id;this._rpc.query(t,{q:"ping"},function(t,o,s){return t?e(t):o.r&&o.r.id&&i.isBuffer(o.r.id)&&o.r.id.length===n._hashLength?i.isBuffer(r)&&!r.equals(o.r.id)?e(new Error("Unexpected node id")):(n.updateBucketTimestamp(),void e(null,{id:o.r.id,host:s.host||s.address,port:s.port})):e(new Error("Bad reply"))})},v.prototype.toJSON=function(){var t=this,e={};return Object.keys(this._values.cache).forEach(function(n){var r=t._values.cache[n].value;e[n]={v:r.v.toString("hex"),id:r.id.toString("hex")},null!=r.seq&&(e[n].seq=r.seq),null!=r.sig&&(e[n].sig=r.sig.toString("hex")),null!=r.k&&(e[n].k=r.k.toString("hex"))}),{nodes:this._rpc.nodes.toArray().map(E),values:e}},v.prototype.put=function(t,e){(i.isBuffer(t)||"string"==typeof t)&&(t={v:t});var n=!!t.k;if(void 0===t.v)throw new Error("opts.v not given");if(t.v.length>=1e3)throw new Error("v must be less than 1000 bytes in put()");if(n&&void 0!==t.cas&&"number"!=typeof t.cas)throw new Error("opts.cas must be an integer if provided");if(n&&!t.k)throw new Error("opts.k ed25519 public key required for mutable put");if(n&&32!==t.k.length)throw new Error("opts.k ed25519 public key must be 32 bytes");if(n&&"function"!=typeof t.sign&&!i.isBuffer(t.sig))throw new Error("opts.sign function or options.sig signature is required for mutable put");if(n&&t.salt&&t.salt.length>64)throw new Error("opts.salt is > 64 bytes long");if(n&&void 0===t.seq)throw new Error("opts.seq not provided for a mutable update");if(n&&"number"!=typeof t.seq)throw new Error("opts.seq not an integer");return this._put(t,e)},v.prototype._put=function(t,e){e||(e=m);var n=!!t.k,o="string"==typeof t.v?i.from(t.v):t.v,s=n?this._hash(t.salt?i.concat([t.k,t.salt]):t.k):this._hash(r.encode(o)),u=this._tables.get(s.toString("hex"));if(!u)return this._preput(s,t,e);var c={q:"put",a:{id:this._rpc.id,token:null,v:o}};return n&&("number"==typeof t.cas&&(c.a.cas=t.cas),t.salt&&(c.a.salt=t.salt),c.a.k=t.k,c.a.seq=t.seq,"function"==typeof t.sign?c.a.sig=t.sign(x(c.a)):i.isBuffer(t.sig)&&(c.a.sig=t.sig)),this._values.set(s.toString("hex"),c.a),this._rpc.queryAll(u.closest(s),c,null,function(t,n){if(t)return e(t,s,n);e(null,s,n)}),s},v.prototype._preput=function(t,e,n){var r=this;return this._closest(t,{q:"get",a:{id:this._rpc.id,target:t}},null,function(t,i){if(t)return n(t);r.put(e,n)}),t},v.prototype.get=function(t,e,o){t=A(t),"function"==typeof e&&(o=e,e=null),e||(e={});var u=e.verify||this._verify,c=this._hash,a=this._values.get(t.toString("hex"))||null;if(a)return a=w(this._rpc.id,null,a),n.nextTick(f);function f(t){if(t)return o(t);o(null,a)}this._closest(t,{q:"get",a:{id:this._rpc.id,target:t}},function(e){var n=e.r;if(!n||!n.v)return!0;if(n.k||n.sig){if(!u||!n.sig||!n.k)return!0;if(!u(n.sig,x(n),n.k))return!0;s(c(n.salt?i.concat([n.k,n.salt]):n.k),t)&&(!a||n.seq>a.seq)&&(a=n)}else if(s(c(r.encode(n.v)),t))return a=n,!1;return!0},f)},v.prototype.announce=function(t,e,n){if("function"==typeof e)return this.announce(t,0,e);t=A(t),n||(n=m);var r=this._tables.get(t.toString("hex"));if(!r)return this._preannounce(t,e,n);if(this._host){var i=this.listening?this.address().port:0;this._addPeer({host:this._host,port:e||i},t,{host:this._host,port:i})}var o={q:"announce_peer",a:{id:this._rpc.id,token:null,info_hash:t,port:e,implied_port:e?0:1}};this._debug("announce %s %d",t,e),this._rpc.queryAll(r.closest(t),o,null,n)},v.prototype._preannounce=function(t,e,n){var r=this;this.lookup(t,function(i){return r.destroyed?n(new Error("dht is destroyed")):i?n(i):void r.announce(t,e,n)})},v.prototype.lookup=function(t,e){t=A(t),e||(e=m);var r=this,i=!1;function o(e,n){e||(e=r._peers.get(t.toString("hex"),100));for(var i=function(t){var e=[];try{for(var n=0;n<t.length;n++){var r=t[n].readUInt16BE(4);r&&e.push({host:k(t[n],0),port:r})}}catch(t){}return e}(e),o=0;o<i.length;o++)r.emit("peer",i[o],t,n||null)}return this._debug("lookup %s",t),n.nextTick(o),this._closest(t,{q:"get_peers",a:{id:this._rpc.id,info_hash:t}},function(t,e){if(i)return!1;t.r.values&&o(t.r.values,e)},e),function(){i=!0}},v.prototype.address=function(){return this._rpc.address()},v.prototype.listen=function(){this._rpc.bind.apply(this._rpc,arguments)},v.prototype.destroy=function(t){if(this.destroyed)t&&n.nextTick(t);else{this.destroyed=!0;var e=this;clearInterval(this._interval),this.removeBucketCheckInterval(),this._peers.destroy(),this._debug("destroying"),this._rpc.destroy(function(){e.emit("close"),t&&t()})}},v.prototype._onquery=function(t,e){var n=t.q.toString();if(this._debug("received %s query from %s:%d",n,e.address,e.port),t.a)switch(n){case"ping":return this._rpc.response(e,t,{id:this._rpc.id});case"find_node":return this._onfindnode(t,e);case"get_peers":return this._ongetpeers(t,e);case"announce_peer":return this._onannouncepeer(t,e);case"get":return this._onget(t,e);case"put":return this._onput(t,e)}},v.prototype._onfindnode=function(t,e){var n=t.a.target;if(!n)return this._rpc.error(e,t,[203,"`find_node` missing required `a.target` field"]);this.emit("find_node",n);var r=this._rpc.nodes.closest(n);this._rpc.response(e,t,{id:this._rpc.id},r)},v.prototype._ongetpeers=function(t,e){var n=e.address||e.host,r=t.a.info_hash;if(!r)return this._rpc.error(e,t,[203,"`get_peers` missing required `a.info_hash` field"]);this.emit("get_peers",r);var i={id:this._rpc.id,token:this._generateToken(n)},o=this._peers.get(r.toString("hex"));o.length?(i.values=o,this._rpc.response(e,t,i)):this._rpc.response(e,t,i,this._rpc.nodes.closest(r))},v.prototype._onannouncepeer=function(t,e){var n=e.address||e.host,r=t.a.implied_port?e.port:t.a.port;if(!(!r||"number"!=typeof r||r<=0||r>65535)){var i=t.a.info_hash,o=t.a.token;if(i&&o){if(!this._validateToken(n,o))return this._rpc.error(e,t,[203,"cannot `announce_peer` with bad token"]);this.emit("announce_peer",i,{host:n,port:e.port}),this._addPeer({host:n,port:r},i,{host:n,port:e.port}),this._rpc.response(e,t,{id:this._rpc.id})}}},v.prototype._addPeer=function(t,e,n){this._peers.add(e.toString("hex"),function(t,e){for(var n=i.allocUnsafe(6),r=t.split("."),o=0;o<4;o++)n[o]=parseInt(r[o]||0,10);return n.writeUInt16BE(e,4),n}(t.host,t.port)),this.emit("announce",t,e,n)},v.prototype._onget=function(t,e){var n=e.address||e.host,r=t.a.target;if(r){var i=this._generateToken(n),o=this._values.get(r.toString("hex"));if(this.emit("get",r,o),o)this._rpc.response(e,t,w(this._rpc.id,i,o));else{var s=this._rpc.nodes.closest(r);this._rpc.response(e,t,{id:this._rpc.id,token:i},s)}}},v.prototype._onput=function(t,e){var n=e.address||e.host,o=t.a;if(o){var s=t.a.v;if(s){var u=t.a.id;if(u){var c=o.token;if(c){if(!this._validateToken(n,c))return this._rpc.error(e,t,[203,"cannot `put` with bad token"]);if(s.length>1e3)return this._rpc.error(e,t,[205,"data payload too large"]);var a=!(!o.k&&!o.sig);if(!a||o.k||o.sig){var f=a?this._hash(o.salt?i.concat([o.k,o.salt]):o.k):this._hash(r.encode(s)),h=f.toString("hex");if(this.emit("put",f,s),a){if(!this._verify)return this._rpc.error(e,t,[400,"verification not supported"]);if(!this._verify(o.sig,x(o),o.k))return;var l=this._values.get(h);if(l&&"number"==typeof o.cas&&l.seq!==o.cas)return this._rpc.error(e,t,[301,"CAS mismatch, re-read and try again"]);if(l&&"number"==typeof l.seq&&!(o.seq>l.seq))return this._rpc.error(e,t,[302,"sequence number less than current"]);this._values.set(h,{v:s,k:o.k,salt:o.salt,sig:o.sig,seq:o.seq,id:u})}else this._values.set(h,{v:s,id:u});this._rpc.response(e,t,{id:this._rpc.id})}}}}}},v.prototype._bootstrap=function(t){var e=this;if(!t)return n.nextTick(r);function r(){e.ready||(e._debug("emit ready"),e.ready=!0,e.emit("ready"))}this._rpc.populate(e._rpc.id,{q:"find_node",a:{id:e._rpc.id,target:e._rpc.id}},r)},v.prototype._closest=function(t,e,n,r){var o=this,s=new a({localNodeId:t,numberOfNodesPerKBucket:this._rpc.k});this._rpc.closest(t,e,function(e,r){if(!e.r)return!0;e.r.token&&e.r.id&&i.isBuffer(e.r.id)&&e.r.id.length===o._hashLength&&(o._debug("found node %s (target: %s)",e.r.id,t),s.add({id:e.r.id,host:r.host||r.address,port:r.port,token:e.r.token}));return!n||n(e,r)},function(e,n){if(e)return r(e);o._tables.set(t.toString("hex"),s),o._debug("visited %d nodes",n),r(null,n)})},v.prototype._debug=function(){if(o.enabled){var t=[].slice.call(arguments);t[0]="["+this.nodeId.toString("hex").substring(0,7)+"] "+t[0];for(var e=1;e<t.length;e++)i.isBuffer(t[e])&&(t[e]=t[e].toString("hex"));o.apply(null,t)}},v.prototype._validateToken=function(t,e){var n=this._generateToken(t,this._secrets[0]),r=this._generateToken(t,this._secrets[1]);return s(e,n)||s(e,r)},v.prototype._generateToken=function(t,e){return e||(e=this._secrets[0]),this._hash(i.concat([i.from(t),e]))},v.prototype._rotateSecrets=function(){this._secrets?(this._secrets[1]=this._secrets[0],this._secrets[0]=l(this._hashLength)):this._secrets=[l(this._hashLength),l(this._hashLength)]}}).call(this,t("_process"))},{_process:23,bencode:3,"buffer-equals":11,debug:8,events:12,inherits:14,"k-bucket":17,"k-rpc":19,"last-one-wins":20,lru:21,randombytes:24,"record-cache":25,"safe-buffer":26,"simple-sha1":8}],5:[function(t,e,n){var r=t("./client"),i=t("./server");e.exports=r,e.exports.Client=r,e.exports.Server=i},{"./client":4,"./server":6}],6:[function(t,e,n){e.exports=t("./client")},{"./client":4}],7:[function(t,e,n){},{}],8:[function(t,e,n){arguments[4][7][0].apply(n,arguments)},{dup:7}],9:[function(t,e,n){"use strict";n.byteLength=function(t){var e=a(t),n=e[0],r=e[1];return 3*(n+r)/4-r},n.toByteArray=function(t){for(var e,n=a(t),r=n[0],s=n[1],u=new o(function(t,e,n){return 3*(e+n)/4-n}(0,r,s)),c=0,f=s>0?r-4:r,h=0;h<f;h+=4)e=i[t.charCodeAt(h)]<<18|i[t.charCodeAt(h+1)]<<12|i[t.charCodeAt(h+2)]<<6|i[t.charCodeAt(h+3)],u[c++]=e>>16&255,u[c++]=e>>8&255,u[c++]=255&e;2===s&&(e=i[t.charCodeAt(h)]<<2|i[t.charCodeAt(h+1)]>>4,u[c++]=255&e);1===s&&(e=i[t.charCodeAt(h)]<<10|i[t.charCodeAt(h+1)]<<4|i[t.charCodeAt(h+2)]>>2,u[c++]=e>>8&255,u[c++]=255&e);return u},n.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],s=0,u=n-i;s<u;s+=16383)o.push(f(t,s,s+16383>u?u:s+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,c=s.length;u<c;++u)r[u]=s[u],i[s.charCodeAt(u)]=u;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function f(t,e,n){for(var i,o,s=[],u=e;u<n;u+=3)i=(t[u]<<16&16711680)+(t[u+1]<<8&65280)+(255&t[u+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],10:[function(t,e,n){"use strict";var r=t("base64-js"),i=t("ieee754");n.Buffer=u,n.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function s(t){if(t>o)throw new RangeError("Invalid typed array length");var e=new Uint8Array(t);return e.__proto__=u.prototype,e}function u(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(t)}return c(t,e,n)}function c(t,e,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return F(t)||t&&F(t.buffer)?function(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n);return r.__proto__=u.prototype,r}(t,e,n):"string"==typeof t?function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!u.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var n=0|p(t,e),r=s(n),i=r.write(t,e);i!==n&&(r=r.slice(0,i));return r}(t,e):function(t){if(u.isBuffer(t)){var e=0|l(t.length),n=s(e);return 0===n.length?n:(t.copy(n,0,0,e),n)}if(t){if(ArrayBuffer.isView(t)||"length"in t)return"number"!=typeof t.length||z(t.length)?s(0):h(t);if("Buffer"===t.type&&Array.isArray(t.data))return h(t.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(t)}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t){return a(t),s(t<0?0:0|l(t))}function h(t){for(var e=t.length<0?0:0|l(t.length),n=s(e),r=0;r<e;r+=1)n[r]=255&t[r];return n}function l(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||F(t))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return M(t).length;default:if(r)return j(t).length;e=(""+e).toLowerCase(),r=!0}}function d(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function g(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),z(n=+n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=u.from(e,r)),u.isBuffer(e))return 0===e.length?-1:_(t,e,n,r,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):_(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(t,e,n,r,i){var o,s=1,u=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,u/=2,c/=2,n/=2}function a(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var f=-1;for(o=n;o<u;o++)if(a(t,o)===a(e,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===c)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(n+c>u&&(n=u-c),o=n;o>=0;o--){for(var h=!0,l=0;l<c;l++)if(a(t,o+l)!==a(e,l)){h=!1;break}if(h)return o}return-1}function y(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;r>o/2&&(r=o/2);for(var s=0;s<r;++s){var u=parseInt(e.substr(2*s,2),16);if(z(u))return s;t[n+s]=u}return s}function v(t,e,n,r){return R(j(e,t.length-n),t,n,r)}function m(t,e,n,r){return R(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function b(t,e,n,r){return m(t,e,n,r)}function w(t,e,n,r){return R(M(e),t,n,r)}function k(t,e,n,r){return R(function(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function x(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function E(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,u,c,a=t[i],f=null,h=a>239?4:a>223?3:a>191?2:1;if(i+h<=n)switch(h){case 1:a<128&&(f=a);break;case 2:128==(192&(o=t[i+1]))&&(c=(31&a)<<6|63&o)>127&&(f=c);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(c=(15&a)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:o=t[i+1],s=t[i+2],u=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&u)&&(c=(15&a)<<18|(63&o)<<12|(63&s)<<6|63&u)>65535&&c<1114112&&(f=c)}null===f?(f=65533,h=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),i+=h}return function(t){var e=t.length;if(e<=A)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=A));return n}(r)}n.kMaxLength=o,u.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{get:function(){if(this instanceof u)return this.buffer}}),Object.defineProperty(u.prototype,"offset",{get:function(){if(this instanceof u)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(t,e,n){return c(t,e,n)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(t,e,n){return function(t,e,n){return a(t),t<=0?s(t):void 0!==e?"string"==typeof n?s(t).fill(e,n):s(t).fill(e):s(t)}(t,e,n)},u.allocUnsafe=function(t){return f(t)},u.allocUnsafeSlow=function(t){return f(t)},u.isBuffer=function(t){return null!=t&&!0===t._isBuffer},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=u.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(ArrayBuffer.isView(o)&&(o=u.from(o)),!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},u.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,n);case"utf8":case"utf-8":return E(this,e,n);case"ascii":return B(this,e,n);case"latin1":case"binary":return S(this,e,n);case"base64":return x(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,n,r,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,s=n-e,c=Math.min(o,s),a=this.slice(r,i),f=t.slice(e,n),h=0;h<c;++h)if(a[h]!==f[h]){o=a[h],s=f[h];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},u.prototype.indexOf=function(t,e,n){return g(this,t,e,n,!0)},u.prototype.lastIndexOf=function(t,e,n){return g(this,t,e,n,!1)},u.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return y(this,t,e,n);case"utf8":case"utf-8":return v(this,t,e,n);case"ascii":return m(this,t,e,n);case"latin1":case"binary":return b(this,t,e,n);case"base64":return w(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function B(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function S(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function T(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=P(t[o]);return i}function q(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function O(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,n,r,i,o){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function L(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(t,e,n,r,o){return e=+e,n>>>=0,o||L(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function N(t,e,n,r,o){return e=+e,n>>>=0,o||L(t,0,n,8),i.write(t,e,n,r,52,8),n+8}u.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=u.prototype,r},u.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},u.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},u.prototype.readUInt8=function(t,e){return t>>>=0,e||O(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return t>>>=0,e||O(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return t>>>=0,e||O(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return t>>>=0,e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return t>>>=0,e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},u.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||O(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return t>>>=0,e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){t>>>=0,e||O(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(t,e){t>>>=0,e||O(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(t,e){return t>>>=0,e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return t>>>=0,e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return t>>>=0,e||O(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return t>>>=0,e||O(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return t>>>=0,e||O(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return t>>>=0,e||O(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e>>>=0,n>>>=0,r)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},u.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e>>>=0,n>>>=0,r)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},u.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,1,255,0),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},u.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},u.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},u.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},u.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var o=0,s=1,u=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===u&&0!==this[e+o-1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+n},u.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var o=n-1,s=1,u=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===u&&0!==this[e+o+1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+n},u.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},u.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},u.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},u.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},u.prototype.writeFloatLE=function(t,e,n){return U(this,t,e,!0,n)},u.prototype.writeFloatBE=function(t,e,n){return U(this,t,e,!1,n)},u.prototype.writeDoubleLE=function(t,e,n){return N(this,t,e,!0,n)},u.prototype.writeDoubleBE=function(t,e,n){return N(this,t,e,!1,n)},u.prototype.copy=function(t,e,n,r){if(!u.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i=r-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,n,r);else if(this===t&&n<e&&e<r)for(var o=i-1;o>=0;--o)t[o+e]=this[o+n];else Uint8Array.prototype.set.call(t,this.subarray(n,r),e);return i},u.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){var i=t.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(t=i)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=u.isBuffer(t)?t:new u(t,r),c=s.length;if(0===c)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<n-e;++o)this[o+e]=s[o%c]}return this};var C=/[^+/0-9A-Za-z-_]/g;function P(t){return t<16?"0"+t.toString(16):t.toString(16)}function j(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function M(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(C,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function R(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function F(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function z(t){return t!=t}},{"base64-js":9,ieee754:13}],11:[function(t,e,n){(function(t){"use strict";e.exports=function(e,n){if(!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(e===n)return!0;if("function"==typeof e.equals)return e.equals(n);if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}}).call(this,{isBuffer:t("../is-buffer/index.js")})},{"../is-buffer/index.js":15}],12:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,u,c,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(s(n=this._events[t]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),n.apply(this,u)}else if(o(n))for(u=Array.prototype.slice.call(arguments,1),r=(a=n.slice()).length,c=0;c<r;c++)a[c].apply(this,u);return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){if(!i(e))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},r.prototype.removeListener=function(t,e){var n,r,s,u;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(n=this._events[t]).length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(u=s;u-- >0;)if(n[u]===e||n[u].listener&&n[u].listener===e){r=u;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],13:[function(t,e,n){n.read=function(t,e,n,r,i){var o,s,u=8*i-r-1,c=(1<<u)-1,a=c>>1,f=-7,h=n?i-1:0,l=n?-1:1,p=t[e+h];for(h+=l,o=p&(1<<-f)-1,p>>=-f,f+=u;f>0;o=256*o+t[e+h],h+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=r;f>0;s=256*s+t[e+h],h+=l,f-=8);if(0===o)o=1-a;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=a}return(p?-1:1)*s*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var s,u,c,a=8*o-i-1,f=(1<<a)-1,h=f>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+h>=1?l/c:l*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=f?(u=0,s=f):s+h>=1?(u=(e*c-1)*Math.pow(2,i),s+=h):(u=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&u,p+=d,u/=256,i-=8);for(s=s<<i|u,a+=i;a>0;t[n+p]=255&s,p+=d,s/=256,a-=8);t[n+p-d]|=128*g}},{}],14:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],15:[function(t,e,n){function r(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}e.exports=function(t){return null!=t&&(r(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&r(t.slice(0,0))}(t)||!!t._isBuffer)}},{}],16:[function(t,e,n){!function(t){var e="|",n="(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",r="[0-9]|[1-2][0-9]|3[0-2]",i="("+n+"\\.){3}"+n+"(\\/("+r+"))?",o="(((([0-9a-fA-F]){1,4}:){6}(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|::(([0-9a-fA-F]){1,4}:){5}(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|([0-9a-fA-F]){1,4}::(([0-9a-fA-F]){1,4}:){4}(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|(([0-9a-fA-F]){1,4}:){0,1}([0-9a-fA-F]){1,4}::(([0-9a-fA-F]){1,4}:){3}(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|(([0-9a-fA-F]){1,4}:){0,2}([0-9a-fA-F]){1,4}::(([0-9a-fA-F]){1,4}:){2}(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|(([0-9a-fA-F]){1,4}:){0,3}([0-9a-fA-F]){1,4}::([0-9a-fA-F]){1,4}:(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|(([0-9a-fA-F]){1,4}:){0,4}([0-9a-fA-F]){1,4}::(([0-9a-fA-F]){1,4}:([0-9a-fA-F]){1,4}|((0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\.){3}(0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))?)|(([0-9a-fA-F]){1,4}:){0,5}([0-9a-fA-F]){1,4}::([0-9a-fA-F]){1,4}|(([0-9a-fA-F]){1,4}:){0,6}([0-9a-fA-F]){1,4}::)(\\/("+r+"))?)",s="((v|V)[0-9a-fA-F]+\\.[a-zA-Z0-9-\\._~!$&'()*+,;=:]+("+r+")?)",u=new RegExp("^("+i+e+o+e+s+")$"),c=new RegExp("^"+i+"$"),a=new RegExp("^"+o+"$"),f=new RegExp("^"+s+"$");t.exports={test:function(t){return u.test(t)},v4:function(t){return c.test(t)},v6:function(t){return a.test(t)},future:function(t){return f.test(t)}}}(e)},{}],17:[function(t,e,n){"use strict";var r=t("randombytes"),i=t("events").EventEmitter,o=t("inherits");function s(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;++n)if(t[n]!==e[n])return!1;return!0}function u(t){if(i.call(this),t=t||{},this.localNodeId=t.localNodeId||r(20),!(this.localNodeId instanceof Uint8Array))throw new TypeError("localNodeId is not a Uint8Array");this.numberOfNodesPerKBucket=t.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=t.numberOfNodesToPing||3,this.distance=t.distance||u.distance,this.arbiter=t.arbiter||u.arbiter,this.root={contacts:[],dontSplit:!1,left:null,right:null},this.metadata=Object.assign({},t.metadata)}e.exports=u,o(u,i),u.arbiter=function(t,e){return t.vectorClock>e.vectorClock?t:e},u.distance=function(t,e){for(var n=0,r=Math.min(t.length,e.length),i=Math.max(t.length,e.length),o=0;o<r;++o)n=256*n+(t[o]^e[o]);for(;o<i;++o)n=256*n+255;return n},u.prototype.add=function(t){if(!(t&&t.id instanceof Uint8Array))throw new TypeError("contact.id is not a Uint8Array");for(var e=0,n=this.root;null===n.contacts;)n=this._determineNode(n,t.id,e++);var r=this._indexOf(n,t.id);return r>=0?(this._update(n,r,t),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(t),this.emit("added",t),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),t),this):(this._split(n,e),this.add(t))},u.prototype.closest=function(t,e){if(!(t instanceof Uint8Array))throw new TypeError("id is not a Uint8Array");if(void 0===e&&(e=1/0),"number"!=typeof e||isNaN(e)||e<=0)throw new TypeError("n is not positive number");for(var n=[],r=[this.root],i=0;r.length>0&&n.length<e;){var o=r.pop();if(null===o.contacts){var s=this._determineNode(o,t,i++);r.push(o.left===s?o.right:o.left),r.push(s)}else n=n.concat(o.contacts)}var u=this;return n.sort(function(e,n){return u.distance(e.id,t)-u.distance(n.id,t)}).slice(0,e)},u.prototype.count=function(){for(var t=0,e=[this.root];e.length>0;){var n=e.pop();null===n.contacts?e.push(n.right,n.left):t+=n.contacts.length}return t},u.prototype._determineNode=function(t,e,n){var r=~~(n/8),i=n%8;return e.length<=r&&0!==i?t.left:e[r]&Math.pow(2,7-i)?t.right:t.left},u.prototype.get=function(t){if(!(t instanceof Uint8Array))throw new TypeError("id is not a Uint8Array");for(var e=0,n=this.root;null===n.contacts;)n=this._determineNode(n,t,e++);var r=this._indexOf(n,t);return r>=0?n.contacts[r]:null},u.prototype._indexOf=function(t,e){for(var n=0;n<t.contacts.length;++n)if(s(t.contacts[n].id,e))return n;return-1},u.prototype.remove=function(t){if(!(t instanceof Uint8Array))throw new TypeError("id is not a Uint8Array");for(var e=0,n=this.root;null===n.contacts;)n=this._determineNode(n,t,e++);var r=this._indexOf(n,t);if(r>=0){var i=n.contacts.splice(r,1)[0];this.emit("removed",i)}return this},u.prototype._split=function(t,e){t.left={contacts:[],dontSplit:!1,left:null,right:null},t.right={contacts:[],dontSplit:!1,left:null,right:null};for(var n=0;n<t.contacts.length;++n){var r=t.contacts[n];this._determineNode(t,r.id,e).contacts.push(r)}t.contacts=null;var i=this._determineNode(t,this.localNodeId,e);(t.left===i?t.right:t.left).dontSplit=!0},u.prototype.toArray=function(){for(var t=[],e=[this.root];e.length>0;){var n=e.pop();null===n.contacts?e.push(n.right,n.left):t=t.concat(n.contacts)}return t},u.prototype._update=function(t,e,n){if(!s(t.contacts[e].id,n.id))throw new Error("wrong index for _update");var r=t.contacts[e],i=this.arbiter(r,n);i===r&&r!==n||(t.contacts.splice(e,1),t.contacts.push(i),this.emit("updated",r,i))}},{events:12,inherits:14,randombytes:24}],18:[function(t,e,n){var r=t("dgram"),i=t("bencode"),o=t("net").isIP,s=t("dns"),u=t("util"),c=t("events"),a=t("safe-buffer").Buffer,f=t("buffer-equals"),h=new Error("Query timed out");h.code="ETIMEDOUT";var l=new Error("Unexpected node id");function p(t){if(!(this instanceof p))return new p(t);t||(t={});var e=this;this.timeout=t.timeout||2e3,this.inflight=0,this.destroyed=!1,this.isIP=t.isIP||o,this.socket=t.socket||r.createSocket("udp4"),this.socket.on("message",function(t,n){if(e.destroyed)return;if(!n.port)return;try{var r=i.decode(t)}catch(t){return e.emit("warning",t)}var o=r&&r.y&&r.y.toString();if("r"===o||"e"===o){if(!a.isBuffer(r.t))return;try{var s=r.t.readUInt16BE(0)}catch(p){return e.emit("warning",p)}var u=e._ids.indexOf(s);if(-1===u||0===s)return e.emit("response",r,n),void e.emit("warning",new Error("Unexpected transaction id: "+s));var c=e._reqs[u];if(c.peer.host!==n.address)return e.emit("response",r,n),void e.emit("warning",new Error("Out of order response"));if(e._ids[u]=0,e._reqs[u]=null,e.inflight--,"e"===o){var h=Array.isArray(r.e),p=new Error(h?r.e.join(" "):"Unknown error");return p.code=h&&r.e.length&&"number"==typeof r.e[0]?r.e[0]:0,c.callback(p,r,n,c.message),e.emit("update"),void e.emit("postupdate")}var d=r.r&&r.r.id;if(c.peer&&c.peer.id&&d&&!f(c.peer.id,d))return c.callback(l,null,n),e.emit("update"),void e.emit("postupdate");c.callback(null,r,n,c.message),e.emit("update"),e.emit("postupdate"),e.emit("response",r,n)}else"q"===o?e.emit("query",r,n):e.emit("warning",new Error("Unknown type: "+o))}),this.socket.on("error",function(t){"EACCES"===t.code||"EADDRINUSE"===t.code?e.emit("error",t):e.emit("warning",t)}),this.socket.on("listening",function(){e.emit("listening")}),this._tick=0,this._ids=[],this._reqs=[],this._timer=setInterval(function(){var t=e.inflight;if(!t)return;for(var n=0;n<e._reqs.length;n++){var r=e._reqs[n];if(r&&(r.ttl?r.ttl--:e._cancel(n,h),!--t))return}},this.timeout/4|0),c.EventEmitter.call(this)}function d(){}l.code="EUNEXPECTEDNODE",e.exports=p,u.inherits(p,c.EventEmitter),p.prototype.address=function(){return this.socket.address()},p.prototype.response=function(t,e,n,r){this.send(t,{t:e.t,y:"r",r:n},r)},p.prototype.error=function(t,e,n,r){this.send(t,{t:e.t,y:"e",e:[].concat(n.message||n)},r)},p.prototype.send=function(t,e,n){var r=i.encode(e);this.socket.send(r,0,r.length,t.port,t.address||t.host,n||d)},p.prototype.bind=function(){this.socket.bind.apply(this.socket,arguments)},p.prototype.destroy=function(t){this.destroyed=!0,clearInterval(this._timer),t&&this.socket.on("close",t);for(var e=0;e<this._ids.length;e++)this._cancel(e);this.socket.close()},p.prototype.query=function(t,e,n){if(n||(n=d),!this.isIP(t.host))return this._resolveAndQuery(t,e,n);var r={t:a.allocUnsafe(2),y:"q",q:e.q,a:e.a},i={ttl:4,peer:t,message:r,callback:n};65535===this._tick&&(this._tick=0);var o=++this._tick,s=this._ids.indexOf(0);for(-1===s&&(s=this._ids.push(0)-1),this._ids[s]=o;this._reqs.length<s;)this._reqs.push(null);return this._reqs[s]=i,this.inflight++,r.t.writeUInt16BE(o,0),this.send(t,r),o},p.prototype.cancel=function(t,e){var n=this._ids.indexOf(t);n>-1&&this._cancel(n,e)},p.prototype._cancel=function(t,e){var n=this._reqs[t];this._ids[t]=0,this._reqs[t]=null,n&&(this.inflight--,n.callback(e||new Error("Query was cancelled"),null,n.peer),this.emit("update"),this.emit("postupdate"))},p.prototype._resolveAndQuery=function(t,e,n){var r=this;s.lookup(t.host,function(i,o){return i?n(i):r.destroyed?n(new Error("k-rpc-socket is destroyed")):void r.query({host:o,port:t.port},e,n)})}},{bencode:3,"buffer-equals":11,dgram:8,dns:8,events:12,net:8,"safe-buffer":26,util:29}],19:[function(t,e,n){(function(n){var r=t("k-rpc-socket"),i=t("k-bucket"),o=t("buffer-equals"),s=t("events"),u=t("randombytes"),c=t("util"),a=t("safe-buffer").Buffer,f=20,h=16,l=[{host:"router.bittorrent.com",port:6881},{host:"router.utorrent.com",port:6881},{host:"dht.transmissionbt.com",port:6881}];function p(t){if(!(this instanceof p))return new p(t);t||(t={});var e,n=this;function i(t,e){if(t&&d(t.id,n._idLength)&&!o(t.id,n.id)){var r=n.nodes.get(t.id);if(r)return void(r.seen=Date.now());n._addNode({id:t.id,host:e.address||e.host,port:e.port,distance:0,seen:Date.now()})}}this._idLength=t.idLength||20,this.id=function(t){if(a.isBuffer(t))return t;if(ArrayBuffer.isView(t))return a.from(t.buffer,t.byteOffset,t.byteLength);if("string"==typeof t)return a.from(t,"hex");throw new Error("Pass a buffer or a string")}(t.id||t.nodeId||u(this._idLength)),this.socket=t.krpcSocket||r(t),this.bootstrap=!1===(e=t.nodes||t.bootstrap)?[]:!0===e?l:[].concat(e||l).map(_),this.concurrency=t.concurrency||h,this.backgroundConcurrency=t.backgroundConcurrency||this.concurrency/4|0,this.k=t.k||f,this.destroyed=!1,this.pending=[],this.nodes=null,this.socket.setMaxListeners(0),this.socket.on("query",function(t,e){i(t.a,e),n.emit("query",t,e)}),this.socket.on("response",function(t,e){i(t.r,e)}),this.socket.on("warning",function(t){n.emit("warning",t)}),this.socket.on("error",function(t){n.emit("error",t)}),this.socket.on("update",function(){for(;n.pending.length&&n.socket.inflight<n.concurrency;){var t=n.pending.shift();n.query(t[0],t[1],t[2])}}),this.socket.on("listening",function(){n.emit("listening")}),s.EventEmitter.call(this),this.clear()}function d(t,e){return t&&a.isBuffer(t)&&t.length===e}function g(t,e){return t[e++]+"."+t[e++]+"."+t[e++]+"."+t[e++]}function _(t){return"string"==typeof t?{host:t.split(":")[0],port:Number(t.split(":")[1])}:t}function y(){}e.exports=p,c.inherits(p,s.EventEmitter),p.prototype.response=function(t,e,n,r,i){"function"==typeof r&&(i=r,r=null),n.id||(n.id=this.id),r&&(n.nodes=function(t,e){for(var n=a.allocUnsafe(t.length*(e+6)),r=0,i=0;i<t.length;i++){var o=t[i];if(d(o.id,e)){o.id.copy(n,r),r+=e;for(var s=(o.host||o.address).split("."),u=0;u<4;u++)n[r++]=parseInt(s[u]||0,10);n.writeUInt16BE(o.port,r),r+=2}}return r===n.length?n:n.slice(0,r)}(r,this._idLength)),this.socket.response(t,e,n,i)},p.prototype.error=function(t,e,n,r){this.socket.error(t,e,n,r)},p.prototype.bind=function(){this.socket.bind.apply(this.socket,arguments)},p.prototype.address=function(){return this.socket.address()},p.prototype.queryAll=function(t,e,n,r){e.a||(e.a={}),e.a.id||(e.a.id=this.id);var i=!1,o=t.length,s=0,u=null;if(!o)return r(new Error("No nodes to query"),0);for(var c=0;c<t.length;c++)this.query(t[c],e,a);function a(t,e,c){t?t.code>=300&&t.code<400&&(u=t):s++,t||i||n&&!1===n(e,c)&&(i=!0),--o||r(s?null:u||new Error("All queries failed"),s)}},p.prototype.query=function(t,e,n){this.socket.inflight>=this.concurrency?this.pending.push([t,e,n]):(e.a||(e.a={}),e.a.id||(e.a.id=this.id),t.token&&(e.a.token=t.token),this.socket.query(t,e,n))},p.prototype.destroy=function(t){this.destroyed=!0,this.socket.destroy(t)},p.prototype.clear=function(){var t=this;this.nodes=new i({localNodeId:this.id,numberOfNodesPerKBucket:this.k,numberOfNodesToPing:this.concurrency}),this.nodes.on("ping",function(e,n){t.emit("ping",e,function(e){e&&(e.id&&t.nodes.remove(e.id),t._addNode(n))})})},p.prototype.populate=function(t,e,n){this._closest(t,e,!0,null,n)},p.prototype.closest=function(t,e,n,r){this._closest(t,e,!1,n,r)},p.prototype._addNode=function(t){var e=this.nodes.get(t.id);this.nodes.add(t),e||this.emit("node",t)},p.prototype._closest=function(t,e,r,s,u){u||(u=y);var c=this,a=0,f={},h=0,l=!0,p=!1;e.a||(e.a={}),e.a.id||(e.a.id=this.id);var _=new i({localNodeId:t,numberOfNodesPerKBucket:this.k,numberOfNodesToPing:this.concurrency}),v=r?"postupdate":"update";function m(){if(!(c.destroyed||c.socket.inflight>=c.concurrency)){var i=c.pending.length+c.socket.inflight-h;if(!(r&&c.socket.inflight>=c.backgroundConcurrency&&i)){var o=_.closest(t,c.k);(!o.length||o.length<c.bootstrap.length)&&(!(o=c.nodes.closest(t,c.k)).length||o.length<c.bootstrap.length)&&function(){if(!l)return;l=!1,c.bootstrap.forEach(function(t){h++,c.socket.query(t,e,w)})}();for(var s=0;s<o.length&&!p;s++){if(c.socket.inflight>=c.concurrency)return;var u=o[s],a=u.host+":"+u.port;f[a]||(f[a]=!0,h++,c.socket.query(u,e,w))}h||(c.socket.removeListener(v,m),n.nextTick(b))}}}function b(){u(null,a)}function w(t,e,n){h--,n&&(f[(n.address||n.host)+":"+n.port]=!0),n&&n.id&&c.nodes.get(n.id)&&(!t||"EUNEXPECTEDNODE"!==t.code&&"ETIMEDOUT"!==t.code||c.nodes.remove(n.id));var r=e&&e.r;if(!r)return m();!t&&d(r.id,c._idLength)&&(a++,k({id:r.id,port:n.port,host:n.host||n.address,distance:0}));for(var i=r.nodes?function(t,e){var n=[];try{for(var r=0;r<t.length;r+=e+6){var i=t.readUInt16BE(r+(e+4));i&&n.push({id:t.slice(r,r+e),host:g(t,r+e),port:i,distance:0,token:null})}}catch(t){}return n}(r.nodes,c._idLength):[],o=0;o<i.length;o++)k(i[o]);s&&!1===s(e,n)&&(p=!0),m()}function k(t){o(t.id,c.id)||_.add(t)}this.socket.on(v,m),m()}}).call(this,t("_process"))},{_process:23,"buffer-equals":11,events:12,"k-bucket":17,"k-rpc-socket":18,randombytes:24,"safe-buffer":26,util:29}],20:[function(t,e,n){function r(t){}e.exports=function(t){var e=null,n=null,i=null,o=null;return function(t,e){o=t,s(e||r)};function s(r){if(n)return e||(e=[]),void e.push(r);var i=o;o=null,n=r,t(i,u)}function u(t){var o=n,u=i;if(i=null,n=null,e&&(i=e,e=null,s(r)),u)for(var c=0;c<u.length;c++)u[c](t);o(t)}}},{}],21:[function(t,e,n){var r=t("events"),i=t("inherits");function o(t){if(!(this instanceof o))return new o(t);"number"==typeof t&&(t={max:t}),t||(t={}),r.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=t.max||1e3,this.maxAge=t.maxAge||0}e.exports=o,i(o,r.EventEmitter),Object.defineProperty(o.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),o.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},o.prototype.remove=function(t){if("string"!=typeof t&&(t=""+t),this.cache.hasOwnProperty(t)){var e=this.cache[t];return delete this.cache[t],this._unlink(t,e.prev,e.next),e.value}},o.prototype._unlink=function(t,e,n){this.length--,0===this.length?this.head=this.tail=null:this.head===t?(this.head=e,this.cache[this.head].next=null):this.tail===t?(this.tail=n,this.cache[this.tail].prev=null):(this.cache[e].next=n,this.cache[n].prev=e)},o.prototype.peek=function(t){if(this.cache.hasOwnProperty(t)){var e=this.cache[t];if(this._checkAge(t,e))return e.value}},o.prototype.set=function(t,e){var n;if("string"!=typeof t&&(t=""+t),this.cache.hasOwnProperty(t)){if((n=this.cache[t]).value=e,this.maxAge&&(n.modified=Date.now()),t===this.head)return e;this._unlink(t,n.prev,n.next)}else n={value:e,modified:0,next:null,prev:null},this.maxAge&&(n.modified=Date.now()),this.cache[t]=n,this.length===this.max&&this.evict();return this.length++,n.next=null,n.prev=this.head,this.head&&(this.cache[this.head].next=t),this.head=t,this.tail||(this.tail=t),e},o.prototype._checkAge=function(t,e){return!(this.maxAge&&Date.now()-e.modified>this.maxAge)||(this.remove(t),this.emit("evict",{key:t,value:e.value}),!1)},o.prototype.get=function(t){if("string"!=typeof t&&(t=""+t),this.cache.hasOwnProperty(t)){var e=this.cache[t];if(this._checkAge(t,e))return this.head!==t&&(t===this.tail?(this.tail=e.next,this.cache[this.tail].prev=null):this.cache[e.prev].next=e.next,this.cache[e.next].prev=e.prev,this.cache[this.head].next=t,e.prev=this.head,e.next=null,this.head=t),e.value}},o.prototype.evict=function(){if(this.tail){var t=this.tail,e=this.remove(this.tail);this.emit("evict",{key:t,value:e})}}},{events:12,inherits:14}],22:[function(t,e,n){e.exports=n=window.fetch,n.default=window.fetch.bind(window),n.Headers=window.Headers,n.Request=window.Request,n.Response=window.Response},{}],23:[function(t,e,n){var r,i,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function c(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{i="function"==typeof clearTimeout?clearTimeout:u}catch(t){i=u}}();var a,f=[],h=!1,l=-1;function p(){h&&a&&(h=!1,a.length?f=a.concat(f):l=-1,f.length&&d())}function d(){if(!h){var t=c(p);h=!0;for(var e=f.length;e;){for(a=f,f=[];++l<e;)a&&a[l].run();l=-1,e=f.length}a=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===u||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function _(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];f.push(new g(t,e)),1!==f.length||h||c(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=_,o.addListener=_,o.once=_,o.off=_,o.removeListener=_,o.removeAllListeners=_,o.emit=_,o.prependListener=_,o.prependOnceListener=_,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],24:[function(t,e,n){(function(n,r){"use strict";var i=t("safe-buffer").Buffer,o=r.crypto||r.msCrypto;o&&o.getRandomValues?e.exports=function(t,e){if(t>65536)throw new Error("requested too many random bytes");var s=new r.Uint8Array(t);t>0&&o.getRandomValues(s);var u=i.from(s.buffer);if("function"==typeof e)return n.nextTick(function(){e(null,u)});return u}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:23,"safe-buffer":26}],25:[function(t,e,n){(function(t){var n=[];function r(){this.list=[],this.map=new Map}function i(){this.records=new Map,this.size=0}function o(t){if(!(this instanceof o))return new o(t);if(t||(t={}),this.maxSize=t.maxSize||1/0,this.maxAge=t.maxAge||0,this._fresh=new i,this._stale=new i,this._interval=null,this.maxAge&&this.maxAge<1/0){var e=Math.ceil(2/3*this.maxAge);this._interval=setInterval(this._gc.bind(this),e),this._interval.unref&&this._interval.unref()}}function s(e){return t.isBuffer(e)?e.toString("hex"):e}function u(t,e,n){var r=t[e];r.index=n,t[n].index=e,t[e]=t[n],t[n]=r}e.exports=o,r.prototype.add=function(t,e){var n=s(t),r=this.map.get(n);return!r&&(r={index:this.list.length,record:e||t},this.list.push(r),this.map.set(n,r),!0)},r.prototype.remove=function(t){var e=s(t),n=this.map.get(e);return!!n&&(u(this.list,n.index,this.list.length-1),this.list.pop(),this.map.delete(e),!0)},i.prototype.add=function(t,e,n){var i=this.records.get(t);return i||(i=new r,this.records.set(t,i)),!!i.add(e,n)&&(this.size++,!0)},i.prototype.remove=function(t,e,n){var r=this.records.get(t);return!!r&&(!!r.remove(e,n)&&(this.size--,r.map.size||this.records.delete(t),!0))},i.prototype.get=function(t){var e=this.records.get(t);return e?e.list:n},Object.defineProperty(o.prototype,"size",{get:function(){return this._fresh.size+this._stale.size}}),o.prototype.add=function(t,e,n){this._stale.remove(t,e,n),this._fresh.add(t,e,n)&&this._fresh.size>this.maxSize&&this._gc()},o.prototype.remove=function(t,e,n){this._fresh.remove(t,e,n),this._stale.remove(t,e,n)},o.prototype.get=function(t,e){var n=this._fresh.get(t),r=this._stale.get(t),i=n.length,o=r.length,s=i+o;(e>s||!e)&&(e=s);for(var c=new Array(e),a=0;a<e;a++){var f=Math.floor(Math.random()*(i+o));f<i?(c[a]=n[f].record,u(n,f,--i)):(f-=i,c[a]=r[f].record,u(r,f,--o))}return c},o.prototype._gc=function(){this._stale=this._fresh,this._fresh=new i},o.prototype.clear=function(){this._gc(),this._gc()},o.prototype.destroy=function(){this.clear(),clearInterval(this._interval),this._interval=null}}).call(this,{isBuffer:t("../is-buffer/index.js")})},{"../is-buffer/index.js":15}],26:[function(t,e,n){var r=t("buffer"),i=r.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,n),n.Buffer=s),o(i,s),s.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},s.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},{buffer:10}],27:[function(t,e,n){arguments[4][14][0].apply(n,arguments)},{dup:14}],28:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],29:[function(t,e,n){(function(e,r){var i=/%[sdj%]/g;n.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(u(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(t).replace(i,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),c=r[n];n<o;c=r[++n])g(c)||!b(c)?s+=" "+c:s+=" "+u(c);return s},n.deprecate=function(t,i){if(v(r.process))return function(){return n.deprecate(t,i).apply(this,arguments)};if(!0===e.noDeprecation)return t;var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),o=!0}return t.apply(this,arguments)}};var o,s={};function u(t,e){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(e)?r.showHidden=e:e&&n._extend(r,e),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),f(r,t,r.depth)}function c(t,e){var n=u.styles[e];return n?"["+u.colors[n][0]+"m"+t+"["+u.colors[n][1]+"m":t}function a(t,e){return t}function f(t,e,r){if(t.customInspect&&e&&x(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(r,t);return y(i)||(i=f(t,i,r)),i}var o=function(t,e){if(v(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(_(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,e);if(o)return o;var s=Object.keys(e),u=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(e)),k(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(e);if(0===s.length){if(x(e)){var c=e.name?": "+e.name:"";return t.stylize("[Function"+c+"]","special")}if(m(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(w(e))return t.stylize(Date.prototype.toString.call(e),"date");if(k(e))return h(e)}var a,b="",E=!1,A=["{","}"];(p(e)&&(E=!0,A=["[","]"]),x(e))&&(b=" [Function"+(e.name?": "+e.name:"")+"]");return m(e)&&(b=" "+RegExp.prototype.toString.call(e)),w(e)&&(b=" "+Date.prototype.toUTCString.call(e)),k(e)&&(b=" "+h(e)),0!==s.length||E&&0!=e.length?r<0?m(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),a=E?function(t,e,n,r,i){for(var o=[],s=0,u=e.length;s<u;++s)S(e,String(s))?o.push(l(t,e,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(l(t,e,n,r,i,!0))}),o}(t,e,r,u,s):s.map(function(n){return l(t,e,r,u,n,E)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(a,b,A)):A[0]+b+A[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function l(t,e,n,r,i,o){var s,u,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?u=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(u=t.stylize("[Setter]","special")),S(r,i)||(s="["+i+"]"),u||(t.seen.indexOf(c.value)<0?(u=g(n)?f(t,c.value,null):f(t,c.value,n-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+u.split("\n").map(function(t){return"   "+t}).join("\n")):u=t.stylize("[Circular]","special")),v(s)){if(o&&i.match(/^\d+$/))return u;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+u}function p(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function g(t){return null===t}function _(t){return"number"==typeof t}function y(t){return"string"==typeof t}function v(t){return void 0===t}function m(t){return b(t)&&"[object RegExp]"===E(t)}function b(t){return"object"==typeof t&&null!==t}function w(t){return b(t)&&"[object Date]"===E(t)}function k(t){return b(t)&&("[object Error]"===E(t)||t instanceof Error)}function x(t){return"function"==typeof t}function E(t){return Object.prototype.toString.call(t)}function A(t){return t<10?"0"+t.toString(10):t.toString(10)}n.debuglog=function(t){if(v(o)&&(o=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(o)){var r=e.pid;s[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else s[t]=function(){};return s[t]},n.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=d,n.isNull=g,n.isNullOrUndefined=function(t){return null==t},n.isNumber=_,n.isString=y,n.isSymbol=function(t){return"symbol"==typeof t},n.isUndefined=v,n.isRegExp=m,n.isObject=b,n.isDate=w,n.isError=k,n.isFunction=x,n.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},n.isBuffer=t("./support/isBuffer");var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}n.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[A(t.getHours()),A(t.getMinutes()),A(t.getSeconds())].join(":"),[t.getDate(),B[t.getMonth()],e].join(" ")),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":28,_process:23,inherits:27}],30:[function(t,e,n){(function(n){(function(){var r,i,o,s,u,c,a,f=[].slice,h=Array.from||function(t){return f.call(t)};function l(t,e){var n;return{id:t.slice(0,e),host:(n=p(t.slice(e,e+6))).host,port:n.port}}function p(t){return{host:t[0]+"."+t[1]+"."+t[2]+"."+t[3],port:t.readUInt16BE(4)}}function d(t,e){var r;return t=n.from(t.split(".").map(function(t){return parseInt(t,10)})),(r=n.alloc(2)).writeUInt16BE(e),e=r,n.concat([t,e])}function g(t){var e=this;if(null==t&&(t={}),!(this instanceof g))return new g(t);if(!(t=Object.assign({},t)).k)throw new Error("k-rpc-socket-webrtc requires options.k to be specified explicitly");if(this._k=Math.max(2,Math.floor(Math.log2(t.k))),!t.id)throw new Error("k-rpc-socket-webrtc requires options.id to be specified explicitly");n.isBuffer(t.id)?this.id=t.id:this.id=n.from(t.id,"hex"),t.socket=t.socket||u(t),t.socket.on("update_http_request_peer",function(t,n,r){var i,o,s,u;for(i=0,s=(o=e._reqs).length;i<s;++i)(u=o[i])&&u.peer.host===t&&u.peer.port===n&&(u.peer=r)}),t.isIP=function(){return!0},this._id_length=t.id.length,this._info_length=this._id_length+6,this._extensions=t.extensions||[],s.call(this,t)}r=("function"==typeof(i=t("debug"))?i("webtorrent-dht"):void 0)||function(){},o=t("inherits"),s=t("k-rpc-socket"),u=t("./webrtc-socket"),e.exports=g,o(c=function(){},s),o(g,c),(a=g.prototype).send=function(t,e,n){r("send to peer: %o",arguments),s.prototype.send.call(this,t,e,n)},a.response=function(t,e,n,i){var o,u,c=this;switch(r("response: %o",arguments),n=Object.assign({},n),e.q.toString()){case"find_node":case"get_peers":case"get":if(o=e.a.signals,!Array.isArray(o))return;if(n.nodes)n.nodes.length/this._info_length>o.length&&(n.nodes=n.nodes.slice(0,o.length*this._info_length)),u=function(t,e){var n,r,i,o,s;for(n=[],r=0,o=t.length,i=e+6;i<0?r>o:r<o;r+=i)s=r,n.push(l(t.slice(s,s+e+6),e));return n.filter(Boolean)}(n.nodes,this._id_length);else{if(!n.values){s.prototype.response.call(this,t,e,n,i);break}n.values.length>o.length&&(n.values=n.values(0,o.length)),u=n.values.map(p)}Promise.all(function(){var t,e,n,r=[];for(t=0,n=(e=u).length;t<n;++t)r.push(i.call(this,t,e[t]));return r;function i(t,e){var n=this;return new Promise(function(r){var i,s;i=o[t],s={q:"peer_connection",a:{id:n.id,signal:i}},n.query(e,s,function(t,e){r({error:t,response:e})})})}}.call(this)).then(function(r){var o,a,f,h,l;for(o=[],a=0,f=u.length;a<f;++a)r[h=a].error?o.push(null):o.push((null!=(l=r[h].response.r)?l.signal:void 0)||null);n.signals=o,s.prototype.response.call(c,t,e,n,i)});break;default:s.prototype.response.call(this,t,e,n,i)}},a.query=function(t,e,i){var o=this;switch(r("query: %o",arguments),(e=Object.assign({},e)).q.toString()){case"find_node":case"get_peers":case"get":Promise.all(function(){var t,e,n=[];for(t=0,e=this._k;t<e;++t)t,n.push(new Promise(r));return n;function r(t){var e,n;(e=n=o.socket._prepare_connection(!0)).once("signal",function(e){e.id=o.id,e.extensions=o._extensions,t({peer_connection:n,signal:e})}),e.once("error",function(e){t(null)})}}.call(this)).then(function(r){var u,c,a,f,l;for(r=r.filter(Boolean),u=[],c=[],a=0,f=r.length;a<f;++a)l=r[a],u.push(l.peer_connection),c.push(l.signal);e.a.signals=c,s.prototype.query.call(o,t,e,function(t,r){var s,c,a,f,l;for(c=[],a=2,f=arguments.length;a<f;++a)c.push(arguments[a]);s=c,!t&&Array.isArray(r.r.signals)?(l=e.a.id.toString("hex"),Promise.all(function(){var t,e,i,o=[];for(t=0,i=(e=r.r.signals).length;t<i;++t)o.push(s.call(this,t,e[t]));return o;function s(t,e){var i,o,s,c=this;return e?(i=e.id.toString("hex"))===l?null:(o=this.socket.get_id_mapping(i),s=function(e){return r.r.nodes?(i=r.r.nodes.slice(t*c._info_length,t*c._info_length+c._id_length),o=e.remoteAddress,s=e.remotePort,i=n.from(i),u=d(o,s),n.concat([i,u])):r.r.values?d(e.remoteAddress,e.remotePort):null;var i,o,s,u},o?(u[t].destroy(),s(o)):r.r.nodes||r.r.values?new Promise(function(n){var r,o;(r=u[t]).destroyed?n(null):((o=r).once("connect",function(){c.socket._add_id_mapping(i,r),r.destroyed||n(s(r))}),o.once("close",function(){var t;t=c.socket.get_id_mapping(i),n(t?s(t):null)}),o.signal(e))}):null):null}}.call(o)).then(function(e){e=e.filter(Boolean),r.r.nodes?r.r.nodes=n.concat(e,e.length*o._info_length):r.r.values&&(r.r.values=e),i.apply(null,[t,r].concat(h(s)))})):i.apply(null,[t,r].concat(h(s)))})});break;default:s.prototype.query.call(this,t,e,i)}},a.emit=function(t){var e,n,r,i,o,u,c,a,f,h,l,p,d,g,_,y=this;for(n=[],r=1,i=arguments.length;r<i;++r)n.push(arguments[r]);switch(e=n,t){case"query":switch(o=e[0],u=e[1],null!=(c=o.a)&&c.id&&this.socket._add_id_mapping(o.a.id.toString("hex"),u),null!=(a=o.q)&&"function"==typeof a.toString&&a.toString()){case"peer_connection":return void(null!=(f=o.a)&&f.signal&&(h=o.a.signal,(l=h.id.toString("hex"))===this.id.toString("hex")||this.socket.get_id_mapping(l)?this.response(u,o,{id:this.id,signal:{id:this.id}}):(p=!1,(d=g=this.socket._prepare_connection(!1)).once("connect",function(){y.socket._add_id_mapping(l,g)}),d.once("signal",function(t){p||(p=!0,t.id=y.id,t.extensions=y._extensions,y.response(u,o,{id:y.id,signal:t}))}),d.once("error",function(t){p||(p=!0,y.error(u,o,[201,t]))}),d.signal(h))))}break;case"response":o=e[0],u=e[1],null!=(_=o.r)&&_.id&&this.socket._add_id_mapping(o.r.id.toString("hex"),u)}return s.prototype.emit.apply(this,arguments)}}).call(this)}).call(this,t("buffer").Buffer)},{"./webrtc-socket":32,buffer:10,debug:8,inherits:14,"k-rpc-socket":18}],31:[function(t,e,n){(function(n){(function(){var r,i,o,s,u,c,a;function f(t){var e=this;if(null==t&&(t={}),!(this instanceof f))return new f(t);(t=Object.assign({},t)).id=t.id||t.nodeId||s(t.idLength||20),t.k=t.k||u,t.krpcSocket=t.krpcSocket||o(t),t.bootstrap=t.nodes||t.bootstrap||a,i.call(this,t),this.socket.socket.on("node_disconnected",function(t){e.nodes.remove(n.from(t,"hex"))}),this.nodes.on("added",function(t){e.socket.socket.add_tag(t.id.toString("hex"),"k-rpc-webrtc")}),this.nodes.on("removed",function(t){e.socket.socket.del_tag(t.id.toString("hex"),"k-rpc-webrtc")})}r=t("inherits"),i=t("k-rpc"),o=t("./k-rpc-socket-webrtc"),s=t("randombytes"),e.exports=f,u=2,a=[{host:"127.0.0.1",port:16881}],r(c=function(){},i),r(f,c)}).call(this)}).call(this,t("buffer").Buffer)},{"./k-rpc-socket-webrtc":30,buffer:10,inherits:14,"k-rpc":19,randombytes:24}],32:[function(t,e,n){(function(n){(function(){var r,i,o,s,u,c,a,f,h,l,p,d,g=[].slice,_=Array.from||function(t){return g.call(t)};function y(t){if(null==t&&(t={}),!(this instanceof y))return new y(t);this._peer_connection_timeout=1e3*(t.peer_connection_timeout||l),this._simple_peer_opts=Object.assign({},p,t.simple_peer_opts),this._simple_peer_constructor=t.simple_peer_constructor||f,this._http_address=t.http_address,this._extensions=t.extensions||[],this._peer_connections={},this._all_peer_connections=new Set,this._http_connections_aliases={},this._pending_peer_connections={},this._connections_id_mapping={},s.call(this)}r=t("bencode"),i=("function"==typeof(o=t("debug"))?o("webtorrent-dht"):void 0)||function(){},s=t("events").EventEmitter,u=t("http"),c=t("inherits"),t("isipaddress").test,a=t("node-fetch"),f=t("simple-peer"),h=t("wrtc"),e.exports=y,l=30,p={trickle:!1,wrtc:h},c(y,s),(d=y.prototype).address=function(){if(this.http_server)return this._http_address;throw new Error("HTTP server is not running yet")},d.bind=function(t,e,n){var r,o=this;if(!t||!e||t instanceof Function||e instanceof Function)throw"Both address and port are required for listen call";this.http_server=u.createServer(function(t,e){var n;if("POST"!==t.method)return e.writeHead(400),void e.end();n="",t.on("data",function(t){n+=t}).on("end",function(){var t;try{(t=o._prepare_connection(!1)).once("signal",function(t){i("got signal for HTTP (server): %s",t),t.extensions=o._extensions,t=JSON.stringify(t),e.finished||(e.setHeader("Access-Control-Allow-Origin","*"),e.write(t),e.end())}),t.once("connect",function(){e.finished||(e.writeHead(500),e.end())}),t.once("close",function(){e.finished||(e.writeHead(500),e.end())}),t.signal(JSON.parse(n))}catch(t){t,e.writeHead(400),e.end()}}).setEncoding("utf8")}),(r=this.http_server).listen(t,e,function(){i("listening for HTTP connections on %s:%d",e,t),o._http_address||(o._http_address={address:e,port:t}),o.emit("listening"),"function"==typeof n&&n()}),r.on("error",function(t){o.emit("error",t)})},d.close=function(){this._all_peer_connections.forEach(function(t){t.destroy()}),this.http_server&&this.http_server.close()},d.send=function(t,e,n,r,o,s){var u,c=this;this._peer_connections[o+":"+r]?(this._peer_connections[o+":"+r].send(t),s()):this._http_connections_aliases[o+":"+r]?(u=this._http_connections_aliases[o+":"+r],this.emit("update_http_request_peer",o,r,{host:u.remoteAddress,port:u.remotePort}),u.send(t),s()):this._pending_peer_connections[o+":"+r]?this._pending_peer_connections[o+":"+r].then(function(i){c.send(t,e,n,r,o,s)}).catch(function(){}):(this._pending_peer_connections[o+":"+r]=new Promise(function(u,f){var h,l,p;(h=l=c._prepare_connection(!0)).once("signal",function(t){var e;i("got signal for HTTP (client): %s",t),t.extensions=c._extensions,e={method:"POST",body:JSON.stringify(t)},a("https://"+o+":"+r,e).catch(function(t){if("undefined"==typeof location||"http:"===location.protocol)return a("http://"+o+":"+r,e);throw t}).then(function(t){return t.json()}).then(function(t){l.destroyed?f():l.signal(t)}).catch(function(t){f(),c.emit("error",t)})}),h.once("connect",function(){var i;i={address:l.remoteAddress,port:l.remotePort},c._register_http_connection_alias(i.address,i.port,o,r),l.destroyed?f():(c.send(t,e,n,r,o,s),delete c._pending_peer_connections[o+":"+r],u(i))}),h.once("close",function(){clearTimeout(p)}),p=setTimeout(function(){delete c._pending_peer_connections[o+":"+r],l.connected||f()},c._peer_connection_timeout)}),this._pending_peer_connections[o+":"+r].catch(function(){}))},d._prepare_connection=function(t){var e,o,s,u=this;return i("prepare connection, initiator: %s",t),(e=o=this._simple_peer_constructor(Object.assign({},this._simple_peer_opts,{initiator:t}))).once("connect",function(){var t,e;i("peer connected: %s:%d",o.remoteAddress,o.remotePort),u._register_connection(o),u.http_server&&(t=u.address(),e=JSON.stringify({http_server:{host:t.address,port:t.port}}),u.send(n.from(e),0,e.length,o.remotePort,o.remoteAddress,function(){})),o.once("close",function(){i("peer disconnected: %s:%d",o.remoteAddress,o.remotePort)})}),e.on("data",function(t){var e;if(i.enabled&&i("got data: %o, %s",t,t.toString()),t instanceof Uint8Array&&(t=n.from(t)),!o._http_info_checked){o._http_info_checked=!0;try{if((e=JSON.parse(t)).http_server)return void(o.http_server={host:e.http_server.host.toString(),port:e.http_server.port})}catch(t){}}e=r.decode(t),n.isBuffer(t)&&(o.connected?u.emit("message",t,{address:o.remoteAddress,port:o.remotePort}):o.once("connected",function(){u.emit("message",t,{address:o.remoteAddress,port:o.remotePort})}))}),e.on("error",function(){i("peer error: %o",arguments),u.emit.apply(u,["error"].concat(_(arguments)))}),e.once("close",function(){clearTimeout(s),u._all_peer_connections.delete(o)}),e.setMaxListeners(0),e.signal=function(t){t.sdp=String(t.sdp),t.type=String(t.type),t.extensions&&(t.extensions=t.extensions.map(function(t){return t+""}),t.extensions.length&&u.emit("extensions_received",o,t.extensions)),u._simple_peer_constructor.prototype.signal.call(o,t)},e._tags=new Set,this._all_peer_connections.add(o),s=setTimeout(function(){o.connected&&o._tags.size||o.destroy()},this._peer_connection_timeout),o},d._add_id_mapping=function(t,e){var n,r,o=this;if(!(e instanceof this._simple_peer_constructor)){if(n=e.host||e.address,r=e.port,!this._peer_connections[n+":"+r])return void i("bad peer specified for id mapping: %s => %o",t,{ip:n,port:r});e=this._peer_connections[n+":"+r]}this._connections_id_mapping[t]?this._connections_id_mapping[t]!==e&&e.destroy():(this._connections_id_mapping[t]=e,e.id=t,e.once("close",function(){o._del_id_mapping(t)}),this.emit("node_connected",t))},d._del_id_mapping=function(t){var e;this._connections_id_mapping[t]&&((e=this._connections_id_mapping[t])._tags.size&&!e.destroyed||(delete this._connections_id_mapping[t],e.destroyed||e.destroy(),this.emit("node_disconnected",t)))},d.get_id_mapping=function(t){return this._connections_id_mapping[t]},d.add_tag=function(t,e){var n;(n=this.get_id_mapping(t))&&n._tags.add(e)},d.del_tag=function(t,e){this._connections_id_mapping[t]&&(this._connections_id_mapping[t]._tags.delete(e),this._del_id_mapping(t))},d.known_http_servers=function(){var t;return function(){var e,n=[];for(t in e=this._peer_connections)t=e[t],n.push(t.http_server);return n}.call(this).filter(Boolean)},d._register_connection=function(t){var e,n,r=this;e=t.remoteAddress,n=t.remotePort,this._peer_connections[e+":"+n]=t,t.once("close",function(){delete r._peer_connections[e+":"+n]})},d._register_http_connection_alias=function(t,e,n,r){var i,o=this;i=this._peer_connections[t+":"+e],this._http_connections_aliases[n+":"+r]=i,i.once("close",function(){delete o._http_connections_aliases[n+":"+r]}),this.emit("http_peer_connection_alias",n,r,i)}}).call(this)}).call(this,t("buffer").Buffer)},{bencode:3,buffer:10,debug:8,events:12,http:7,inherits:14,isipaddress:16,"node-fetch":22,"simple-peer":8,wrtc:34}],33:[function(t,e,n){(function(n){(function(){var r,i,o,s,u;function c(t){if(null==t&&(t={}),!(this instanceof c))return new c(t);(t=Object.assign({},t)).hash&&(t.idLength=t.hash(n.from("")).length),t.krpc=t.krpc||o(t),r.call(this,t)}r=t("bittorrent-dht"),i=t("inherits"),o=t("./k-rpc-webrtc"),e.exports=c,i(s=function(){},r),i(c,s),(u=c.prototype).listen=function(t,e,n){null==t&&(t=16881),null==e&&(e="127.0.0.1"),this._rpc.bind(t,e,n)},u.toJSON=function(){return{nodes:this._rpc.socket.socket.known_http_servers(),values:r.prototype.toJSON.call(this).values}}}).call(this)}).call(this,t("buffer").Buffer)},{"./k-rpc-webrtc":31,"bittorrent-dht":5,buffer:10,inherits:14}],34:[function(t,e,n){"use strict";n.RTCIceCandidate=window.RTCIceCandidate,n.RTCPeerConnection=window.RTCPeerConnection,n.RTCSessionDescription=window.RTCSessionDescription},{}],35:[function(t,e,n){(function(){var n,r,i;n=t("bencode"),r=t("webtorrent-dht/webrtc-socket"),i=t("webtorrent-dht"),e.exports={bencode:n,"webrtc-socket":r,"webtorrent-dht":i}}).call(this)},{bencode:3,"webtorrent-dht":33,"webtorrent-dht/webrtc-socket":32}]},{},[35])(35)});